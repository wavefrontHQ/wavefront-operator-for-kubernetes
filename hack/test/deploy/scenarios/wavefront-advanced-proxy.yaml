# Need to change YOUR_CLUSTER_NAME and YOUR_WAVEFRONT_URL accordingly
apiVersion: wavefront.com/v1alpha1
kind: Wavefront
metadata:
  name: wavefront
  namespace: observability-system
spec:
  clusterName: YOUR_CLUSTER_NAME
  wavefrontUrl: YOUR_WAVEFRONT_URL
  wavefrontTokenSecret: wavefront-secret
  dataCollection:
    metrics:
      enable: true
  dataExport:
    wavefrontProxy:
      enable: true
      metricPort: 2878
      preprocessor: advanced-proxy-preprocessor-rules
      resources:
        requests:
          cpu: 200m
          memory: 1Gi
        limits:
          cpu: 500m
          memory: 3Gi
      tracing:
        wavefront:
          port: 30000
          samplingRate: "0.1"
          samplingDuration: 100
        zipkin:
          port: 9411
          applicationName: "zipkin"
        jaeger:
          port: 30001
          httpPort: 30080
          grpcPort: 14250
          applicationName: "jaeger"
      histogram:
        port: 40000
        minutePort: 40001
        hourPort: 40002
        dayPort: 40003
#      httpProxy:
#        secret: http-proxy-secret
      args: >
        --customSourceTags mySource
        --prefix=dev
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: advanced-proxy-preprocessor-rules
  namespace: observability-system
data:
  rules.yaml: |
    '2878':
      - rule: tag-all-metrics-processed
        action: addTag
        tag: processed
        value: "true"

# ---
# apiVersion: v1
# kind: Secret
# metadata:
#   name: http-proxy-secret
#   namespace: observability-system
# type: Opaque
# stringData:
#   http-url: YOUR_HTTP_PROXY_URL #i.e. http://10.96.179.49:8080
#   #  basic-auth-username: YOUR_HTTP_PROXY_BASIC_AUTH_USERNAME
#   #  basic-auth-password: YOUR_HTTP_PROXY__BASIC_AUTH_PASSWORD
#   tls-root-ca-bundle: |
#     YOUR_HTTP_PROXY_CA_CERTIFICATE

